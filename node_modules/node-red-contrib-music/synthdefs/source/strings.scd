// based on ideas from https://www.soundonsound.com/techniques/synthesizing-strings-string-machines

(
SynthDef("strings",
	{ |out_bus = 0, note = 60, amp = 0.5, pan = 0, sustain = 1, sustain_prop = 0.33, cutoff=1000  |
		var threeStrings, panned, detune;
		var freq = midicps(note.clip(0,128));
		var env = EnvGen.ar(
			envelope: Env.linen(sustain*(1-sustain_prop)/2, sustain*sustain_prop, sustain*(1-sustain_prop)/2),
			doneAction: 2);

		threeStrings = // array of 3 strings per note
			Mix.ar(Array.fill(3, { arg i;
				// detune strings, calculate delay time :
			detune = LFNoise0.ar(4,mul:0.005,add:1)*#[0.9997, 1, 1.0005].at(i);
			LPF.ar(Saw.ar(detune*freq), MouseX.kr(50,20000,'exponential'));
			}));
		panned = env*Pan2.ar(threeStrings,pan);


		Out.ar(out_bus, panned)
	}
).store
)

(
str = Synth('strings');
str.set('sustain',10);
)

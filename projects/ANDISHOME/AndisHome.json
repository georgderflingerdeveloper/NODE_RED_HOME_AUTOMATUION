[{"id":"89f4663.1fb9198","type":"tab","label":"WERKSTÄTTE2","disabled":false,"info":""},{"id":"224ea99f.aa7d56","type":"tab","label":"IOCONTROL_PHIDGETS","disabled":false,"info":""},{"id":"bea2f80b.91edc8","type":"tab","label":"IOCONTROL_PHIDGET_CONFIG","disabled":false,"info":""},{"id":"62dabc44.aa9ad4","type":"tab","label":"TESTING_PROTOTYPES","disabled":false,"info":""},{"id":"16ae33ba.369bfc","type":"tab","label":"UNIT_TEST","disabled":false,"info":""},{"id":"30ba2070.c5fb6","type":"subflow","name":"SUB_ON_HOUR_1","info":"","category":"","in":[{"x":20,"y":80,"wires":[{"id":"1a0bfb43.49d945"}]}],"out":[{"x":540,"y":80,"wires":[{"id":"837ceddd.dd08a","port":0}]}],"env":[],"color":"#DDAA99","status":{"x":540,"y":140,"wires":[{"id":"837ceddd.dd08a","port":0}]}},{"id":"62dffab4.e717e4","type":"subflow","name":"SUB_ON_MINUTE1","info":"","category":"","in":[{"x":20,"y":80,"wires":[{"id":"7b27dacf.9ca8b4"}]}],"out":[{"x":540,"y":80,"wires":[{"id":"b2bfb5a0.efb2a8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7390ca22.bd6ab4","type":"subflow","name":"SUB_OFF_HOUR_1","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"f94843f0.4d27d"}]}],"out":[{"x":540,"y":80,"wires":[{"id":"6f52c086.45d28","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"781f4d20.a37674","type":"subflow","name":"SUB_OFF_MINUTE_1","info":"","category":"","in":[{"x":20,"y":80,"wires":[{"id":"da0fafa0.3f9db"}]}],"out":[{"x":540,"y":80,"wires":[{"id":"329d8dec.4441a2","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a8d52260.73814","type":"subflow","name":"SUB_TIME1","info":"","category":"","in":[{"x":40,"y":120,"wires":[{"id":"cea13710.489628"},{"id":"4e1c3640.181948"},{"id":"df01e9d7.0a89b8"},{"id":"5c299832.350e28"}]}],"out":[{"x":400,"y":120,"wires":[{"id":"cea13710.489628","port":0},{"id":"4e1c3640.181948","port":0},{"id":"df01e9d7.0a89b8","port":0},{"id":"5c299832.350e28","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"a1ab711.cebd09","type":"subflow","name":"SUB_CONTROL","info":"","category":"","in":[{"x":60,"y":260,"wires":[{"id":"2d3b1ef7.fcc242"}]}],"out":[{"x":740,"y":200,"wires":[{"id":"8b3804de.7aba68","port":0},{"id":"4be2d5b6.7890fc","port":0},{"id":"dd48777c.f447c8","port":0},{"id":"22bc269f.e38e6a","port":0},{"id":"2d3b1ef7.fcc242","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"c9e62a9e.cd1a28","type":"subflow","name":"SUB_ON_HOUR_2","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"22951f62.fc59f"}]}],"out":[{"x":520,"y":80,"wires":[{"id":"7a421dd7.2483d4","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"daa71ced.89cee","type":"subflow","name":"SUB_ON_MINUTE_2","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"1b4d2a30.a5ea96"}]}],"out":[{"x":560,"y":80,"wires":[{"id":"b7585bcc.5a2428","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"880e0c65.633fd","type":"subflow","name":"SUB_OFF_HOUR_2","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"7e7fcfdd.39216"}]}],"out":[{"x":520,"y":80,"wires":[{"id":"c404386f.22d2e8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7022a155.68146","type":"subflow","name":"SUB_OFF_MINUTE_2","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"ff51d8b4.452888"}]}],"out":[{"x":520,"y":80,"wires":[{"id":"251f0f80.1133a","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"e3cf62e3.6475c","type":"subflow","name":"SUB_TIME_2","info":"","category":"","in":[{"x":20,"y":120,"wires":[{"id":"a346e78f.015638"},{"id":"59121532.97744c"},{"id":"4a8a7e6.ad95d8"},{"id":"4035dd9f.4d91d4"}]}],"out":[{"x":420,"y":120,"wires":[{"id":"a346e78f.015638","port":0},{"id":"59121532.97744c","port":0},{"id":"4a8a7e6.ad95d8","port":0},{"id":"4035dd9f.4d91d4","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"497deffc.3db77","type":"subflow","name":"SUB_OVERRIDE_OFF","info":"","category":"","in":[{"x":40,"y":80,"wires":[{"id":"bd90f5ed.921ae8"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"bd90f5ed.921ae8","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"7d23cd88.369654","type":"subflow","name":"SUB_OVERRIDE_ON","info":"","category":"","in":[{"x":0,"y":80,"wires":[{"id":"95cd355c.15657"}]}],"out":[{"x":380,"y":80,"wires":[{"id":"95cd355c.15657","port":0}]}],"env":[],"color":"#DDAA99"},{"id":"10da58d4.20f697","type":"ui_group","z":"","name":"HAUS","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"d07e3bc1.1627f8","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"3a834059.84a91","type":"ui_tab","z":"","name":"WERKSTÄTTENRAUM2","icon":"dashboard","disabled":false,"hidden":false},{"id":"c7d1a1d5.a6e0f","type":"ui_group","z":"","name":"HEIZUNGSTEUERUNG","tab":"3a834059.84a91","order":1,"disp":true,"width":"6","collapse":true},{"id":"616ab88e.5f5868","type":"ui_group","z":"","name":"The Switch","tab":"","disp":true,"width":"6","collapse":false},{"id":"7a9ab70f.ac1128","type":"chatbot-telegram-node","z":"","botname":"HomeBot","usernames":"","providerToken":"","polling":"1000","store":"","log":"","parseMode":"","debug":false,"webHook":"","connectMode":"polling"},{"id":"213b4b73.8e5d84","type":"chatbot-telegram-node","z":"","botname":"MyGeorgsHome_bot","usernames":"","providerToken":"","polling":"1000","store":"","log":"","parseMode":"","debug":false,"webHook":"","connectMode":"polling"},{"id":"113cf98e.38fec6","type":"telegram bot","z":"","botname":"MyGeorgsHome_bot","usernames":"","chatids":"","baseapiurl":"","updatemode":"polling","pollinterval":"300","usesocks":false,"sockshost":"","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":false},{"id":"198bfa2c.a0f586","type":"ui_switch","z":"89f4663.1fb9198","name":"Heizung","label":"Heizstrahler","tooltip":"","group":"c7d1a1d5.a6e0f","order":14,"width":"6","height":"2","passthru":false,"decouple":"true","topic":"Heizung","style":"","onvalue":"true","onvalueType":"bool","onicon":"fa-3x fa-thermometer-full","oncolor":"yellow","offvalue":"false","offvalueType":"bool","officon":"fa-3x fa-thermometer-empty","offcolor":"white","x":1940,"y":780,"wires":[[]]},{"id":"fb3b6f38.ec426","type":"ui_button","z":"a1ab711.cebd09","name":"","group":"c7d1a1d5.a6e0f","order":2,"width":0,"height":0,"passthru":false,"label":"EIN","tooltip":"","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"bool","topic":"","x":190,"y":80,"wires":[["8b3804de.7aba68"]]},{"id":"dd48777c.f447c8","type":"ui_button","z":"a1ab711.cebd09","name":"","group":"c7d1a1d5.a6e0f","order":3,"width":0,"height":0,"passthru":false,"label":"AUS","tooltip":"","color":"","bgcolor":"","icon":"","payload":"false","payloadType":"bool","topic":"","x":190,"y":180,"wires":[["4be2d5b6.7890fc"]]},{"id":"66ea1a52.dcf674","type":"bigtimer","z":"89f4663.1fb9198","outtopic":"","outpayload1":"","outpayload2":"","name":"TIMER1","comment":"","lat":"48.22908","lon":"13.0208","starttime":"0","endtime":"0","starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":1120,"y":840,"wires":[[],["afeebeb.222fb4","47e9c0cf.f322d"],[]]},{"id":"2d3b1ef7.fcc242","type":"ui_button","z":"a1ab711.cebd09","name":"","group":"c7d1a1d5.a6e0f","order":4,"width":0,"height":0,"passthru":true,"label":"AUTO","tooltip":"","color":"","bgcolor":"","icon":"","payload":"auto","payloadType":"str","topic":"","x":190,"y":260,"wires":[["22bc269f.e38e6a"]]},{"id":"8b3804de.7aba68","type":"change","z":"a1ab711.cebd09","name":"OnOverride","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"on","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":80,"wires":[["f1dd33c6.f924b"]]},{"id":"4be2d5b6.7890fc","type":"change","z":"a1ab711.cebd09","name":"OffOverride","rules":[{"t":"change","p":"payload","pt":"msg","from":"false","fromt":"bool","to":"off","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":330,"y":140,"wires":[["f1dd33c6.f924b"]]},{"id":"22bc269f.e38e6a","type":"change","z":"a1ab711.cebd09","name":"Auto","rules":[{"t":"change","p":"payload","pt":"msg","from":"true","fromt":"bool","to":"auto","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":220,"wires":[["f1dd33c6.f924b"]]},{"id":"f1dd33c6.f924b","type":"ui_text","z":"a1ab711.cebd09","group":"c7d1a1d5.a6e0f","order":5,"width":0,"height":0,"name":"","label":"Befehl","format":"{{msg.payload}}","layout":"row-spread","x":530,"y":200,"wires":[]},{"id":"243cc279.c9c30e","type":"change","z":"89f4663.1fb9198","name":"ConvertOn","rules":[{"t":"change","p":"payload","pt":"msg","from":"ON","fromt":"str","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1750,"y":760,"wires":[["198bfa2c.a0f586"]]},{"id":"701ef43f.64de2c","type":"change","z":"89f4663.1fb9198","name":"ConvertOff","rules":[{"t":"change","p":"payload","pt":"msg","from":"OFF","fromt":"str","to":"false","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":1750,"y":800,"wires":[["198bfa2c.a0f586"]]},{"id":"837ceddd.dd08a","type":"ui_numeric","z":"30ba2070.c5fb6","name":"OnHour","label":"1. Einschalten Stunde","tooltip":"","group":"c7d1a1d5.a6e0f","order":6,"width":0,"height":0,"passthru":false,"topic":"HourOn","format":"{{value}}","min":0,"max":"24","step":1,"x":400,"y":80,"wires":[[]]},{"id":"b2bfb5a0.efb2a8","type":"ui_numeric","z":"62dffab4.e717e4","name":"OnMinute","label":"1. Einschalten Minute","tooltip":"","group":"c7d1a1d5.a6e0f","order":7,"width":0,"height":0,"passthru":false,"topic":"MinuteOn","format":"{{value}}","min":0,"max":"59","step":1,"x":400,"y":80,"wires":[[]]},{"id":"6f52c086.45d28","type":"ui_numeric","z":"7390ca22.bd6ab4","name":"OffHour","label":"1. Ausschalten Stunde","tooltip":"","group":"c7d1a1d5.a6e0f","order":8,"width":0,"height":0,"passthru":false,"topic":"HourOff","format":"{{value}}","min":0,"max":"24","step":1,"x":400,"y":80,"wires":[[]]},{"id":"329d8dec.4441a2","type":"ui_numeric","z":"781f4d20.a37674","name":"OffMinute","label":"1. Ausschalten Minute","tooltip":"","group":"c7d1a1d5.a6e0f","order":9,"width":0,"height":0,"passthru":false,"topic":"MinuteOff","format":"{{value}}","min":0,"max":"59","step":1,"x":400,"y":80,"wires":[[]]},{"id":"f898989b.6fb488","type":"file","z":"89f4663.1fb9198","name":"StoreTimeSettings1","filename":"timesettings1","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":1830,"y":180,"wires":[[]]},{"id":"174a2e39.7eacf2","type":"file in","z":"89f4663.1fb9198","name":"LoadTimeSettings1","filename":"timesettings1","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":350,"y":160,"wires":[["b390c4a5.b763d8"]]},{"id":"825c9871.dfd2f8","type":"inject","z":"89f4663.1fb9198","name":"","topic":"LOAD","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":90,"y":460,"wires":[["174a2e39.7eacf2","21ac702a.99994","ed6e8c6e.a3556"]]},{"id":"b390c4a5.b763d8","type":"json","z":"89f4663.1fb9198","name":"CONVERT_SETTINGS_1","property":"payload","action":"","pretty":false,"x":630,"y":100,"wires":[["98ae152e.4d2f38","75370959.efb778","e101c15b.7d31a","80be2031.65fcf8"]]},{"id":"1a0bfb43.49d945","type":"change","z":"30ba2070.c5fb6","name":"GetHourOnAsValue","rules":[{"t":"move","p":"payload.HourOn","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":190,"y":80,"wires":[["837ceddd.dd08a"]]},{"id":"7b27dacf.9ca8b4","type":"change","z":"62dffab4.e717e4","name":"GetMinuteOnAsValue","rules":[{"t":"move","p":"payload.MinuteOn","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":80,"wires":[["b2bfb5a0.efb2a8"]]},{"id":"f94843f0.4d27d","type":"change","z":"7390ca22.bd6ab4","name":"GetHourOffAsValue","rules":[{"t":"move","p":"payload.HourOff","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":80,"wires":[["6f52c086.45d28"]]},{"id":"da0fafa0.3f9db","type":"change","z":"781f4d20.a37674","name":"GetMinuteOffAsValue","rules":[{"t":"move","p":"payload.MinuteOff","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":80,"wires":[["329d8dec.4441a2"]]},{"id":"95cd355c.15657","type":"function","z":"7d23cd88.369654","name":"ProvideOverrideOnTime","func":"var OnOverride = \"On_Override \";\nmsg.payload = OnOverride + msg.payload.HourOn + \":\" + msg.payload.MinuteOn;\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":80,"wires":[[]]},{"id":"62760622.be76b","type":"inject","z":"89f4663.1fb9198","name":"Reload","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":160,"wires":[["174a2e39.7eacf2","ed6e8c6e.a3556"]]},{"id":"a0f7fd94.9cb4e","type":"inject","z":"89f4663.1fb9198","name":"","topic":"RELAY","payload":"ON","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1500,"y":940,"wires":[["f5d9c65d.fc8e88"]]},{"id":"f5d9c65d.fc8e88","type":"function","z":"89f4663.1fb9198","name":"IO_CONTROL_HEATER_1","func":"var DigitalOutput0 = global.get('PublicDigitalOutput0');\nvar IsInitialized = global.get(\"PublicVintHubInit\");\n\nif( IsInitialized )\n{\n    if( msg.payload === 'ON')\n    {\n        DigitalOutput0.setDutyCycle(1);\n    }\n\n    if( msg.payload === 'OFF')\n    {\n        DigitalOutput0.setDutyCycle(0);\n    }\n}\n    \nreturn msg;","outputs":1,"noerr":0,"x":1930,"y":900,"wires":[[]]},{"id":"d94f9318.e9b56","type":"inject","z":"89f4663.1fb9198","name":"","topic":"RELAY","payload":"OFF","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1510,"y":980,"wires":[["f5d9c65d.fc8e88"]]},{"id":"afeebeb.222fb4","type":"change","z":"89f4663.1fb9198","name":"StringCommandOn","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"num","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":840,"wires":[["f5d9c65d.fc8e88","243cc279.c9c30e"]]},{"id":"47e9c0cf.f322d","type":"change","z":"89f4663.1fb9198","name":"StringCommandOff","rules":[{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"num","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1510,"y":880,"wires":[["f5d9c65d.fc8e88","701ef43f.64de2c"]]},{"id":"d0159537.6a36f8","type":"file in","z":"89f4663.1fb9198","name":"LoadBackupTimeSettings","filename":"backuptimesettings","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":370,"y":40,"wires":[["b390c4a5.b763d8"]]},{"id":"b415ad60.88d5e","type":"inject","z":"89f4663.1fb9198","name":"RestoreBackup","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":160,"y":40,"wires":[["d0159537.6a36f8"]]},{"id":"d19a9f19.61cc3","type":"inject","z":"224ea99f.aa7d56","name":"","topic":"INIT","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":100,"y":60,"wires":[["afd4f6a6.0c7fd8"]]},{"id":"afd4f6a6.0c7fd8","type":"function","z":"224ea99f.aa7d56","name":"INIT_PHIDGETS_DIGITAL_OUTPUTS","func":"var NewMsg = { payload : ''};\nvar phidget22 = global.get('phidget22')\nvar conn = new phidget22.Connection(5661,'192.168.1.100');\nvar Initialized=context.get('init') || 0;\nvar digitalOutput0 = new phidget22.DigitalOutput();\n\ndigitalOutput0.onAttach = function onDigitalOutput0_Error() {\n        global.set(\"PublicVintHubInit\", 1);\n\t\tconsole.log('Vinthub attached!')\n\t};\n\ndigitalOutput0.onDetach = function onDigitalOutput0_Error() {\n\t    global.set(\"PublicVintHubInit\", 0);\n\t\tconsole.log('Vinthub detached!')\n\t};\n\n\nfunction Start()\n{\n    digitalOutput0.setIsHubPortDevice(true);\n    digitalOutput0.setHubPort(0);\n    digitalOutput0.setDeviceSerialNumber(726538);\n    digitalOutput0.open(5000).then(function () \n    {\n       global.set(\"PublicDigitalOutput0\", digitalOutput0);\n    });\n}\nconn.connect().then(Start).catch(function(err) {\n\tconsole.error(\"Error during connect:\", err);\n});\n\nglobal.set(\"PublicPhidget\", conn);\n\nreturn NewMsg;","outputs":1,"noerr":0,"x":360,"y":60,"wires":[[]]},{"id":"c1fd41c.0cbabc","type":"file","z":"bea2f80b.91edc8","name":"PHIDGETSETTINGS","filename":"phidgetsettings","appendNewline":true,"createDir":true,"overwriteFile":"true","encoding":"none","x":570,"y":100,"wires":[[]]},{"id":"b9359544.0e58d8","type":"inject","z":"bea2f80b.91edc8","name":"MAKE_TEMPLATE","topic":"CONFIG_TEMPLATE","payload":"{\"VINTHUB_WORKSHOP_HALL_2\":{\"ipadress\":\"192.168.1.100\",\"port\":5661,\"serialnumber\":726538}}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":230,"y":100,"wires":[["c1fd41c.0cbabc","79ff7c5c.20bdec"]]},{"id":"79ff7c5c.20bdec","type":"debug","z":"bea2f80b.91edc8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":600,"y":180,"wires":[]},{"id":"98ae152e.4d2f38","type":"function","z":"89f4663.1fb9198","name":"StoreLoadedDataIntoContext","func":"var DefaultSettings =   { \n       payload: \n             {\n               HourOn    : 4,\n               MinuteOn  : 0, \n               HourOff   : 12, \n               MinuteOff : 0\n             } \n       \n   };\n\nflow.set('TimeSettingsMemory1',msg) || DefaultSettings;\n\nvar LoadedSettings = flow.get('TimeSettingsMemory1') || DefaultSettings;\nmsg = LoadedSettings;\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":60,"wires":[[]]},{"id":"f94752da.8ffeb","type":"catch","z":"224ea99f.aa7d56","name":"","scope":null,"uncaught":false,"x":100,"y":300,"wires":[["331cbfde.a5f648"]]},{"id":"331cbfde.a5f648","type":"ui_toast","z":"224ea99f.aa7d56","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"","name":"","x":320,"y":300,"wires":[]},{"id":"5ea27fa.c06178","type":"inject","z":"224ea99f.aa7d56","name":"","topic":"INIT","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":120,"y":220,"wires":[["2ad65570.ee8d92"]]},{"id":"2ad65570.ee8d92","type":"function","z":"224ea99f.aa7d56","name":"INIT_DIGITAL_INPUTS","func":"var NewMsg = { topic : \"DigitalInput0\", state : false };\nvar phidget22 = global.get('phidget22');\n\nconsole.log('Opening Digital Input Module 0 ....')\n\nfunction RunDigitalInputHandler() {\n\tvar digitalInput0 = new phidget22.DigitalInput();\n\n\tdigitalInput0.setDeviceSerialNumber(597039);\n\n\tdigitalInput0.onStateChange = function onDigitalInput0_StateChange(state) {\n\t\tconsole.log('State DigitalInput1: ' + state.toString())\n\t\tNewMsg.state = state;\n\t\tnode.send(NewMsg);\n\t\tnode.done();\n\t};\n\n\tdigitalInput0.open(5000).then(function() {\n          console.log('DigitalInput0 open was sucessfull');\n          flow.set( \"DigitalInput0\", digitalInput0 );\n\t}).catch(function (err){\n\t\tconsole.error('Error during open:', err);\n\n\t})\n}\n\nvar conn = new phidget22.Connection(5661, '192.168.1.51');\nconn.connect().then(RunDigitalInputHandler).catch(function (err) {\n\tconsole.error('Error during connect:', err);\n\n});\n\n\nreturn;\n","outputs":1,"noerr":0,"x":350,"y":220,"wires":[["2aba4bba.3fa45c"]]},{"id":"2aba4bba.3fa45c","type":"debug","z":"224ea99f.aa7d56","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":610,"y":220,"wires":[]},{"id":"771644b2.61969c","type":"function","z":"62dabc44.aa9ad4","name":"SwitchOutput","func":"exports.Switch = function( initialized, digout, msg )\n{\n  if( initialized )\n  {\n    if( msg.payload === 'ON')\n    {\n        digout.setDutyCycle(1);\n    }\n\n    if( msg.payload === 'OFF')\n    {\n        digout.setDutyCycle(0);\n    }\n  }   \n}\n\n\n    \n\n","outputs":1,"noerr":0,"x":160,"y":40,"wires":[[]]},{"id":"8bffcc05.4fb28","type":"function","z":"62dabc44.aa9ad4","name":"PrepareMessageToChatBot","func":"msg.payload = {};\nmsg.payload.chatId  = 852123642;\nmsg.payload.type    = 'message';\nmsg.payload.content = 'hello from node-red!';\nreturn msg;\n","outputs":1,"noerr":0,"x":360,"y":160,"wires":[["8e76ae36.91994"]]},{"id":"e8730c0b.22378","type":"inject","z":"62dabc44.aa9ad4","name":"","topic":"START","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":150,"y":160,"wires":[["8bffcc05.4fb28"]]},{"id":"8e76ae36.91994","type":"telegram sender","z":"62dabc44.aa9ad4","name":"BotInformer","bot":"113cf98e.38fec6","x":570,"y":160,"wires":[[]]},{"id":"17c0a21.41e865e","type":"function","z":"62dabc44.aa9ad4","name":"INIT_PHIDGETS_PROTOTYPE","func":"var NewMsg = { payload : ''};\nvar phidget22 = global.get('phidget22')\n\nvar Config =\n{ \n    VintHub : \n    { \n        \"ipadress\":\"192.168.1.100\",\n        \"port\":5661, \n        \"serialnumber\":726538, \n        \"hubport\":0, \n        \"timeout\":5000,\n        \"PublicId\": \"PublicDigitalOutput0\"\n    }\n};\n\nvar conn = new phidget22.Connection(5661,'192.168.1.100');\nvar SerialNumber = 0;\nvar TimeOut = 0;\nvar HubPort = 0;\n\nvar digitalOutput0 = new phidget22.DigitalOutput();\n\ndigitalOutput0.onAttach = function onDigitalOutput0_Error() {\n        global.set(\"PublicVintHubInit\", 1);\n\t\tconsole.log('Vinthub attached!')\n\t};\n\ndigitalOutput0.onDetach = function onDigitalOutput0_Error() {\n\t    global.set(\"PublicVintHubInit\", 0);\n\t\tconsole.log('Vinthub detached!')\n\t};\n\t\n\nfunction StartInstance( Config, phidgetobject )\n{\n    phidgetobject.setIsHubPortDevice(true);\n    phidgetobject.setHubPort(Config.VintHub.hubport);\n    phidgetobject.setDeviceSerialNumber(Config.VintHub.serialnumber);\n    phidgetobject.open(timeout).then(function () \n    {\n       global.set(Config.VintHub.publicid, phidgetobject);\n    });   \n}\n\n\nconn.connect().then(StartInstance(Config, digitalOutput0)).catch(function(err) {\n\tconsole.error(\"Error during connect:\", err);\n});\n\nglobal.set(\"PublicPhidget\", conn);\n\nreturn NewMsg;","outputs":1,"noerr":0,"x":210,"y":80,"wires":[[]]},{"id":"cea13710.489628","type":"subflow:30ba2070.c5fb6","z":"a8d52260.73814","name":"OFF_HOUR_1","env":[],"x":200,"y":80,"wires":[[]]},{"id":"4e1c3640.181948","type":"subflow:62dffab4.e717e4","z":"a8d52260.73814","name":"ON_MINUTE_1","env":[],"x":200,"y":120,"wires":[[]]},{"id":"df01e9d7.0a89b8","type":"subflow:7390ca22.bd6ab4","z":"a8d52260.73814","name":"OFF_HOUR_1","env":[],"x":200,"y":160,"wires":[[]]},{"id":"5c299832.350e28","type":"subflow:781f4d20.a37674","z":"a8d52260.73814","name":"OFF_MINUTE_1","env":[],"x":210,"y":200,"wires":[[]]},{"id":"75370959.efb778","type":"subflow:a8d52260.73814","z":"89f4663.1fb9198","name":"TIME_SETTINGS_1","env":[],"x":920,"y":180,"wires":[["cecf1677.9dba28"]]},{"id":"d3e72391.ca518","type":"bigtimer","z":"89f4663.1fb9198","outtopic":"","outpayload1":"","outpayload2":"","name":"TIMER2","comment":"","lat":"48.22908","lon":"13.0208","starttime":"0","endtime":"0","starttime2":0,"endtime2":0,"startoff":0,"endoff":0,"startoff2":0,"endoff2":0,"offs":0,"outtext1":"on","outtext2":"off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"day6":0,"month6":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"d6":0,"w6":0,"xday1":0,"xmonth1":0,"xday2":0,"xmonth2":0,"xday3":0,"xmonth3":0,"xday4":0,"xmonth4":0,"xday5":0,"xmonth5":0,"xday6":0,"xmonth6":0,"xd1":0,"xw1":0,"xd2":0,"xw2":0,"xd3":0,"xw3":0,"xd4":0,"xw4":0,"xd5":0,"xw5":0,"xd6":0,"xw6":0,"suspend":false,"random":false,"repeat":true,"atstart":true,"odd":false,"even":false,"x":1120,"y":760,"wires":[[],["47e9c0cf.f322d","afeebeb.222fb4"],[]]},{"id":"7a421dd7.2483d4","type":"ui_numeric","z":"c9e62a9e.cd1a28","name":"OnHour2","label":"2. Einschalten Stunde","tooltip":"","group":"c7d1a1d5.a6e0f","order":10,"width":0,"height":0,"passthru":false,"topic":"HourOn","format":"{{value}}","min":0,"max":"24","step":1,"x":380,"y":80,"wires":[[]]},{"id":"22951f62.fc59f","type":"change","z":"c9e62a9e.cd1a28","name":"GetHourOnAsValue","rules":[{"t":"move","p":"payload.HourOn","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":190,"y":80,"wires":[["7a421dd7.2483d4"]]},{"id":"21ac702a.99994","type":"subflow:a1ab711.cebd09","z":"89f4663.1fb9198","name":"CONTROL","env":[],"x":410,"y":800,"wires":[["66ea1a52.dcf674","d3e72391.ca518"]]},{"id":"b470cb08.1c7998","type":"ui_template","z":"89f4663.1fb9198","group":"c7d1a1d5.a6e0f","name":"CLOCK","order":1,"width":0,"height":0,"format":"<script id=\"titleScript\" type=\"text/javascript\">\n\n$(function() {\n    if($('.md-toolbar-tools').length != 0){\n        loadClock();\n    }else setTimeout(loadClock, 500)\n});\n\nfunction loadClock(){\n    $('#clock').remove();\n    var toolbar = $('.md-toolbar-tools');\n    \n    var div = $('<div/>');\n    var p = $('<p/ id=\"clock\">');\n    \n    div.append(p);\n    div[0].style.margin = '5px 5px 5px auto';\n    toolbar.append(div);\n\n    function displayTitle(lh) {\n        p.text(lh); \n    }\n    \n    function upTime() {\n        var d = new Date();\n        p.text(d.toLocaleString());\n    }\n\n    if(document.clockInterval){ \n            clearInterval(document.clockInterval);\n            document.clockInterval = null;\n    }\n        \n    document.clockInterval = setInterval(upTime,1000);\n}\n\n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":700,"y":20,"wires":[[]],"icon":"node-red/timer.svg"},{"id":"a346e78f.015638","type":"subflow:c9e62a9e.cd1a28","z":"e3cf62e3.6475c","name":"SUB_ON_HOUR_2","env":[],"x":190,"y":80,"wires":[[]]},{"id":"b7585bcc.5a2428","type":"ui_numeric","z":"daa71ced.89cee","name":"OnMinute2","label":"2. Einschalten Minute","tooltip":"","group":"c7d1a1d5.a6e0f","order":11,"width":0,"height":0,"passthru":false,"topic":"MinuteOn","format":"{{value}}","min":0,"max":"59","step":1,"x":390,"y":80,"wires":[[]]},{"id":"1b4d2a30.a5ea96","type":"change","z":"daa71ced.89cee","name":"GetMinuteOnAsValue","rules":[{"t":"move","p":"payload.MinuteOn","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":80,"wires":[["b7585bcc.5a2428"]]},{"id":"59121532.97744c","type":"subflow:daa71ced.89cee","z":"e3cf62e3.6475c","name":"SUB_ON_MINUTE_2","env":[],"x":200,"y":120,"wires":[[]]},{"id":"c404386f.22d2e8","type":"ui_numeric","z":"880e0c65.633fd","name":"OffHour2","label":"2. Ausschalten Stunde","tooltip":"","group":"c7d1a1d5.a6e0f","order":12,"width":0,"height":0,"passthru":false,"topic":"HourOff","format":"{{value}}","min":0,"max":"24","step":1,"x":400,"y":80,"wires":[[]]},{"id":"7e7fcfdd.39216","type":"change","z":"880e0c65.633fd","name":"GetHourOffAsValue","rules":[{"t":"move","p":"payload.HourOff","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":80,"wires":[["c404386f.22d2e8"]]},{"id":"4a8a7e6.ad95d8","type":"subflow:880e0c65.633fd","z":"e3cf62e3.6475c","name":"SUB_OFF_HOUR_2","env":[],"x":190,"y":160,"wires":[[]]},{"id":"251f0f80.1133a","type":"ui_numeric","z":"7022a155.68146","name":"OffMinute2","label":"2. Ausschalten Minute","tooltip":"","group":"c7d1a1d5.a6e0f","order":13,"width":0,"height":0,"passthru":false,"topic":"MinuteOff","format":"{{value}}","min":0,"max":"59","step":1,"x":410,"y":80,"wires":[[]]},{"id":"ff51d8b4.452888","type":"change","z":"7022a155.68146","name":"GetMinuteOffAsValue","rules":[{"t":"move","p":"payload.MinuteOff","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":200,"y":80,"wires":[["251f0f80.1133a"]]},{"id":"4035dd9f.4d91d4","type":"subflow:7022a155.68146","z":"e3cf62e3.6475c","name":"SUB_OFF_MINUTE_2","env":[],"x":200,"y":200,"wires":[[]]},{"id":"3473ca66.ff2616","type":"subflow:e3cf62e3.6475c","z":"89f4663.1fb9198","name":"TIMESETTINGS_2","env":[],"x":910,"y":220,"wires":[[]]},{"id":"82ad5bf2.3cb2c8","type":"json","z":"89f4663.1fb9198","name":"CONVERT_SETTINGS_2","property":"payload","action":"","pretty":false,"x":630,"y":220,"wires":[["3473ca66.ff2616"]]},{"id":"ed6e8c6e.a3556","type":"file in","z":"89f4663.1fb9198","name":"LoadTimeSettings2","filename":"timesettings2","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":350,"y":220,"wires":[["82ad5bf2.3cb2c8"]]},{"id":"8dd1158a.e73438","type":"inject","z":"62dabc44.aa9ad4","name":"","topic":"TEST","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":320,"wires":[["140ffbe3.d84834"]]},{"id":"475ba0d.348696","type":"debug","z":"62dabc44.aa9ad4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":830,"y":320,"wires":[]},{"id":"bd90f5ed.921ae8","type":"function","z":"497deffc.3db77","name":"ProvideOverrideOffTime","func":"var OffOverride = \"Off_Override \";\nmsg.payload = OffOverride + msg.payload.HourOff + \":\" + msg.payload.MinuteOff;\nreturn msg;","outputs":1,"noerr":0,"x":190,"y":80,"wires":[[]]},{"id":"cecf1677.9dba28","type":"function","z":"89f4663.1fb9198","name":"PrepareTimeData","func":"var NewMsg = {};\n\n \nvar DefaultSettings =   { \n       payload: \n             {\n               HourOn    : 4,\n               MinuteOn  : 0, \n               HourOff   : 12, \n               MinuteOff : 0\n             } \n       \n   };\n\nvar TimeSettings=flow.get('TimeSettingsMemory1') || DefaultSettings;\n\n\nswitch( msg.topic)\n{\n    case \"HourOn\":\n         TimeSettings.payload.HourOn = msg.payload;\n         break;\n\n    case \"MinuteOn\":\n         TimeSettings.payload.MinuteOn = msg.payload;\n         break;\n         \n    case \"HourOff\":\n         TimeSettings.payload.HourOff = msg.payload;\n         break;\n\n    case \"MinuteOff\":\n         TimeSettings.payload.MinuteOff = msg.payload;\n         break;     \n         \n}\n\nflow.set('TimeSettingsMemory1',TimeSettings);\n\nNewMsg = TimeSettings;\nreturn NewMsg;","outputs":1,"noerr":0,"x":1170,"y":180,"wires":[["f898989b.6fb488","e101c15b.7d31a","80be2031.65fcf8"]]},{"id":"e101c15b.7d31a","type":"subflow:497deffc.3db77","z":"89f4663.1fb9198","name":"OVERRIDE_OFF1","env":[],"x":890,"y":660,"wires":[["66ea1a52.dcf674"]]},{"id":"80be2031.65fcf8","type":"subflow:7d23cd88.369654","z":"89f4663.1fb9198","name":"OVERRIDE_ON_1","env":[],"x":890,"y":720,"wires":[["66ea1a52.dcf674"]]},{"id":"729b219a.243e1","type":"inject","z":"89f4663.1fb9198","name":"","topic":"MAKE_DEFAULT_CONFIGS","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":1250,"y":60,"wires":[["2599235d.bc23ec"]]},{"id":"2599235d.bc23ec","type":"function","z":"89f4663.1fb9198","name":"PREPARE_DEFAULT_SETTINGS","func":"DefaultSettings =   { \n       payload: \n             {\n               HourOn    : 4,\n               MinuteOn  : 0, \n               HourOff   : 12, \n               MinuteOff : 0\n             } \n       \n   };\n   \nmsg = DefaultSettings;\nreturn msg;\n","outputs":1,"noerr":0,"x":1540,"y":60,"wires":[["9374b645.73367","f898989b.6fb488","e29c7266.57592"]]},{"id":"9374b645.73367","type":"debug","z":"89f4663.1fb9198","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1810,"y":40,"wires":[]},{"id":"e29c7266.57592","type":"file","z":"89f4663.1fb9198","name":"StoreTimeSettings2","filename":"timesettings2","appendNewline":false,"createDir":true,"overwriteFile":"true","encoding":"none","x":1830,"y":220,"wires":[[]]},{"id":"9e50cbdc.1c8788","type":"function","z":"62dabc44.aa9ad4","name":"SelectTimeComponents","func":"var NewMsg = {};\n\n \nvar DefaultSettings =   { \n       payload: \n             {\n               HourOn    : 11,\n               MinuteOn  : 22, \n               HourOff   : 33, \n               MinuteOff : 44\n             } \n       \n   };\n\nvar TimeSettings = flow.get('TimeSettingsMemory1') || DefaultSettings;\n\nfunction Select( msg, timesettings )\n{\n  switch( msg.topic)\n  {\n    case \"HourOn\":\n         timesettings.payload.HourOn    = msg.payload;\n         break;\n\n    case \"MinuteOn\":\n         timesettings.payload.MinuteOn  = msg.payload;\n         break;\n         \n    case \"HourOff\":\n         timesettings.payload.HourOff   = msg.payload;\n         break;\n\n    case \"MinuteOff\":\n         timesettings.payload.MinuteOff = msg.payload;\n         break;     \n  }  \n}\n\nSelect( msg, TimeSettings );\n\n\n\nflow.set('TimeSettingsMemory1',TimeSettings);\n\nNewMsg = TimeSettings;\nreturn NewMsg;","outputs":1,"noerr":0,"x":630,"y":320,"wires":[["475ba0d.348696"]]},{"id":"140ffbe3.d84834","type":"function","z":"62dabc44.aa9ad4","name":"Settings_HourOn","func":"var NewMsg =   { \n       topic:   'HourOn',\n       payload: 2\n   };\n\nreturn NewMsg;","outputs":1,"noerr":0,"x":390,"y":320,"wires":[["9e50cbdc.1c8788","7627b2ed.ac722c"]]},{"id":"7627b2ed.ac722c","type":"debug","z":"62dabc44.aa9ad4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":570,"y":380,"wires":[]},{"id":"ad77bf36.33805","type":"inject","z":"62dabc44.aa9ad4","name":"","topic":"TEST","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":400,"y":240,"wires":[["9e50cbdc.1c8788"]]},{"id":"751df3ac.4ad16c","type":"flow-asserter in","z":"16ae33ba.369bfc","name":"PAYLOAD_TEST","testcases":[{"testId":0,"input":"1","inputType":"num","operator":"eq","assert":"2","assertType":"num"},{"testId":1,"input":"0","inputType":"num","operator":"eq","assert":"1","assertType":"num"}],"onlyfail":false,"flowasserterout":"2ddfe89d.aa52a8","x":200,"y":180,"wires":[["2298cb5e.d11384"],["a1beb3f3.574aa"]]},{"id":"2ddfe89d.aa52a8","type":"flow-asserter out","z":"16ae33ba.369bfc","name":"TEST1","x":630,"y":180,"wires":[[]]},{"id":"a1beb3f3.574aa","type":"debug","z":"16ae33ba.369bfc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":380,"y":280,"wires":[]},{"id":"2298cb5e.d11384","type":"function","z":"16ae33ba.369bfc","name":"ADD","func":"msg.payload = msg.payload + 1;\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":180,"wires":[["2ddfe89d.aa52a8","115e2896.fc83e7"]]},{"id":"78c03ff8.534d4","type":"inject","z":"16ae33ba.369bfc","name":"","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":270,"y":120,"wires":[["2298cb5e.d11384"]]},{"id":"115e2896.fc83e7","type":"debug","z":"16ae33ba.369bfc","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":630,"y":240,"wires":[]}]